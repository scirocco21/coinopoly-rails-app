<div class="jumbotron text-center">
  <h1 class="display-4 name"><%= @portfolio.name %></h1>
  <p class="lead value">Total value: $<%= @portfolio.value %></p>
  <% if current_user == @user %>
    <div class="text-right">
      <%= link_to image_tag("https://png.icons8.com/material-sharp/50/000000/pencil.png", height: "15", width: "15"), edit_user_portfolio_path(@user, @portfolio) %>
    </div>
    <div class="text-right">
      <%= render partial: 'delete', locals: {user: @user, portfolio: @portfolio} %>
    </div>
  <% end %>
</div>

<div class='card-group'>
  <%= render @positions %>
</div>


<div class="card" id="new">
  <div class="card-header">
    <h1 class="card-title" id="name"></h1>
  </div>
  <div class="card-body">
    <p id="quantity"></p>
    <p id="value"></p>
  </div>
  <div class="card-footer">
    <img src="#">
  </div>
</div>

<% if current_user == @user %>
  <div class="text-center">
    <%= form_for [@portfolio, @position], html: {id: "position-form", :"data-id"=> @portfolio.id} do |f| %>
      <div class="form-group">
        <label for="coin">Coin:</label>
        <%= f.collection_select :coin_id, Coin.all, :id, :name, {}, {:class=>"form-control"} %><br>
      </div>
      <div class="form-group">
        <label for="quantity">Quantity:</label><br>
        <%= f.number_field :quantity, placeholder: @position.errors.full_messages_for(:quantity).first, step: :any, class:"form-control" %><br>
      </div>
       <%= f.hidden_field :portfolio_id, value: @portfolio.id %>
      <%= f.submit position_form_action, class: "btn btn-lg btn-secondary" %>
    <% end %>
  </div>
<% end %>

<a href="#" class="js-back float-left btn btn-secondary" data-id="<%=@portfolio.id%>">Previous portfolio</a>

<a href="#" class="js-next float-right btn btn-secondary" data-id="<%=@portfolio.id%>">Next portfolio</a>

<script type="text/javascript" charset="utf-8">
$(function () {
  $(".js-next").on("click", function() {
    var nextId = parseInt($(".js-next").attr("data-id")) + 1;
    $.getJSON("/portfolios/" + nextId, function(data) {
      console.log(data)
      $(".name").text(data["name"]);
      // $(".value") - this will need a JS method
      // re-set the id to current on the link
      $(".js-next").attr("data-id", data["id"]);
    });return false;
  });
});
</script>

<script type="text/javascript" charset="utf-8">
$(function () {
  $(".js-back").on("click", function() {
    var backId = parseInt($(".js-next").attr("data-id")) -1;
    $.getJSON("/portfolios/" + backId, function(data) {
      console.log(data)
      $(".name").text(data["name"]);
      // $(".value") - this will need a JS method
      // re-set the id to current on the link
      $(".js-next").attr("data-id", data["id"]);
    });return false;
  });
});
</script>

<script>
$(function () {
   $('#position-form').submit(function(event) {
     //prevent form from submitting the default way
     event.preventDefault();
     var values = $(this).serialize();
     var portfolioId = parseInt($("#position-form").attr("data-id"));
     var posting = $.post('/portfolios/' + portfolioId + "/positions", values);
     posting.done(function(data) {
       $("#name").text(data["coin_id"]);
       $("#quantity").text(data["quantity"]);
     });
   });
 });
</script>
